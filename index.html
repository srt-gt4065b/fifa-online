<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini FIFA Online 4 - PK Shootout</title>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #222;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }

        h1 { margin-bottom: 10px; color: #4fd1c5; }

        /* ê²Œì„ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        #game-container {
            position: relative;
            width: 400px;
            height: 500px;
            background: linear-gradient(to bottom, #2e7d32, #4caf50);
            border: 5px solid #fff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        /* ê³¨ëŒ€ */
        #goal-area {
            position: absolute;
            top: 0;
            left: 50px;
            width: 300px;
            height: 80px;
            border-left: 5px solid white;
            border-right: 5px solid white;
            border-top: 5px solid white;
            background: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.2) 10px, rgba(255,255,255,0.2) 20px);
        }

        /* ê³¨í‚¤í¼ */
        #keeper {
            position: absolute;
            top: 50px;
            left: 175px;
            width: 50px;
            height: 50px;
            background-color: #ffeb3b;
            border-radius: 50%;
            border: 2px solid #333;
            transition: left 0.1s;
            z-index: 2;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: black;
        }

        /* ê³µ */
        #ball {
            position: absolute;
            bottom: 50px;
            left: 180px;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle at 10px 10px, #fff, #ccc);
            border-radius: 50%;
            border: 1px solid #999;
            cursor: pointer;
            z-index: 3;
            transition: all 0.5s ease-in;
        }

        .score-board {
            margin-top: 20px;
            font-size: 24px;
        }

        #message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
            font-weight: bold;
            text-shadow: 2px 2px 4px #000;
            display: none;
            z-index: 10;
        }

        /* ìˆœìœ„í‘œ ìŠ¤íƒ€ì¼ */
        #leaderboard-section {
            margin-top: 30px;
            width: 400px;
            background: #333;
            padding: 20px;
            border-radius: 10px;
        }
        
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: center; border-bottom: 1px solid #555; }
        th { color: #4fd1c5; }

        /* ì…ë ¥ í¼ */
        #save-form {
            display: none;
            margin-top: 20px;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            position: absolute;
            top: 200px;
            border-radius: 10px;
            text-align: center;
            z-index: 20;
        }
        input { padding: 8px; border-radius: 4px; border: none; }
        button { padding: 8px 16px; background: #4fd1c5; border: none; color: #000; cursor: pointer; border-radius: 4px; font-weight: bold;}
        button:hover { background: #38b2ac; }

    </style>
</head>
<body>

    <h1>MINI FIFA PK ONLINE</h1>
    <div class="score-board">í˜„ì¬ ì ìˆ˜: <span id="current-score">0</span></div>

    <div id="game-container">
        <div id="goal-area"></div>
        <div id="keeper">GK</div>
        <div id="ball"></div>
        <div id="message">GOAL!</div>
        
        <div id="save-form">
            <h3>ê²Œì„ ì¢…ë£Œ!</h3>
            <p>ìµœì¢… ì ìˆ˜: <span id="final-score">0</span></p>
            <input type="text" id="player-name" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" maxlength="10">
            <button onclick="saveScore()">ë­í‚¹ ë“±ë¡</button>
            <button onclick="resetGame()">ë‹¤ì‹œ í•˜ê¸°</button>
        </div>
    </div>
    <p style="font-size: 14px; color: #ccc;">ê³µì„ í´ë¦­í•˜ê±°ë‚˜ í„°ì¹˜í•˜ì—¬ ìŠ›ì„ í•˜ì„¸ìš”!</p>

    <div id="leaderboard-section">
        <h3>ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹ (Top 10)</h3>
        <table>
            <thead>
                <tr>
                    <th>ìˆœìœ„</th>
                    <th>ë‹‰ë„¤ì„</th>
                    <th>ì ìˆ˜</th>
                </tr>
            </thead>
            <tbody id="ranking-list">
                <tr><td colspan="3">ë¡œë”© ì¤‘...</td></tr>
            </tbody>
        </table>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // ==========================================
        // [ì¤‘ìš”] Firebase ì„¤ì • - ë³¸ì¸ì˜ ì„¤ì •ê°’ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyAvj8oUjiD6I-sAMpm7qoeX9JGZD-8xZLs",
  authDomain: "fifa-online-45cdc.firebaseapp.com",
  projectId: "fifa-online-45cdc",
  storageBucket: "fifa-online-45cdc.firebasestorage.app",
  messagingSenderId: "520440986474",
  appId: "1:520440986474:web:cd53881e3722fc45e4c313"
        };

        // Firebase ì´ˆê¸°í™” (ì„¤ì •ê°’ì´ ì—†ìœ¼ë©´ ì˜¤ë¥˜ê°€ ë‚˜ë¯€ë¡œ try-catch ì²˜ë¦¬)
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase Connected");
        } catch (e) {
            console.error("Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. ì½”ë“œë¥¼ ì—´ì–´ firebaseConfigë¥¼ ìˆ˜ì •í•˜ì„¸ìš”.");
            document.getElementById('ranking-list').innerHTML = "<tr><td colspan='3'>DB ì—°ê²° í•„ìš”</td></tr>";
        }

        const db = firebase.database();

        // ê²Œì„ ë³€ìˆ˜
        let score = 0;
        let isGaming = true;
        let keeperSpeed = 2000; // ì´ˆê¸° í‚¤í¼ ì†ë„ (ms)
        let keeperDirection = 1; // 1: ì˜¤ë¥¸ìª½, -1: ì™¼ìª½
        let keeperInterval;
        
        const keeper = document.getElementById('keeper');
        const ball = document.getElementById('ball');
        const msg = document.getElementById('message');
        const saveForm = document.getElementById('save-form');
        
        // ê²Œì„ ë£¨í”„ ì‹œì‘ (í‚¤í¼ ì›€ì§ì„)
        function startGame() {
            isGaming = true;
            score = 0;
            document.getElementById('current-score').innerText = score;
            saveForm.style.display = 'none';
            resetPositions();
            moveKeeper();
        }

        // í‚¤í¼ ì›€ì§ì´ê¸° (CSS Animation ëŒ€ì‹  JSë¡œ ì œì–´í•˜ì—¬ ì¶©ëŒ ê°ì§€ ìš©ì´í•˜ê²Œ í•¨)
        function moveKeeper() {
            let pos = 175;
            let direction = 1;
            
            // ë‚œì´ë„ ì¡°ì ˆ: ì ìˆ˜ê°€ ë†’ì„ìˆ˜ë¡ ë¹¨ë¼ì§
            let speed = 3 + Math.floor(score / 3); 

            clearInterval(keeperInterval);
            keeperInterval = setInterval(() => {
                if (!isGaming) return;

                pos += speed * direction;
                
                // ì¢Œìš° ë²½ ì¶©ëŒ ì²´í¬ (ê²Œì„ ì»¨í…Œì´ë„ˆ 400px, í‚¤í¼ 50px)
                if (pos > 350) {
                    pos = 350;
                    direction = -1;
                } else if (pos < 0) {
                    pos = 0;
                    direction = 1;
                }
                keeper.style.left = pos + 'px';
            }, 20);
        }

        // ìŠ› í•˜ê¸°
        ball.addEventListener('click', () => {
            if (!isGaming) return;
            isGaming = false; // ìŠ› í•˜ëŠ” ë™ì•ˆ ê²Œì„ ì •ì§€

            // ê³µì´ ë‚ ì•„ê°€ëŠ” ì• ë‹ˆë©”ì´ì…˜
            ball.style.bottom = '420px'; // ê³¨ëŒ€ ìœ„ì¹˜
            
            // 0.5ì´ˆ(ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„) í›„ì— ê²°ê³¼ íŒì •
            setTimeout(() => {
                checkGoal();
            }, 500);
        });

        function checkGoal() {
            // ìœ„ì¹˜ ê°’ ê°€ì ¸ì˜¤ê¸°
            const keeperRect = keeper.getBoundingClientRect();
            const ballRect = ball.getBoundingClientRect();

            // ì¶©ëŒ ê°ì§€ (ë‹¨ìˆœí™”: xì¶• ê²¹ì¹¨ í™•ì¸)
            // í‚¤í¼ì™€ ê³µì˜ ì¤‘ì‹¬ì  ë¹„êµê°€ ë” ì •í™•í•˜ì§€ë§Œ, ì—¬ê¸°ì„  ê²¹ì¹¨ ì—¬ë¶€ë¡œ íŒë‹¨
            const isBlocked = !(keeperRect.right < ballRect.left || 
                                keeperRect.left > ballRect.right);

            if (isBlocked) {
                // ë§‰í˜ (ê²Œì„ ì˜¤ë²„)
                msg.style.color = 'red';
                msg.innerText = "BLOCKED!";
                msg.style.display = 'block';
                setTimeout(() => {
                    msg.style.display = 'none';
                    gameOver();
                }, 1000);
            } else {
                // ê³¨ì¸
                score++;
                document.getElementById('current-score').innerText = score;
                msg.style.color = '#fff';
                msg.innerText = "GOAL!!";
                msg.style.display = 'block';
                
                setTimeout(() => {
                    msg.style.display = 'none';
                    nextRound();
                }, 1000);
            }
        }

        function nextRound() {
            resetPositions();
            isGaming = true;
            moveKeeper(); // ì†ë„ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ì¬í˜¸ì¶œ
        }

        function resetPositions() {
            ball.style.transition = 'none';
            ball.style.bottom = '50px';
            // ì•½ê°„ì˜ ëœë¤ì„± ë¶€ì—¬ (ê³µ ìœ„ì¹˜)
            ball.style.left = (150 + Math.random() * 60) + 'px';
            
            // reflow ê°•ì œí•˜ì—¬ transition ì œê±° ì ìš©
            void ball.offsetWidth;
            ball.style.transition = 'all 0.5s ease-in';
        }

        function gameOver() {
            saveForm.style.display = 'block';
            document.getElementById('final-score').innerText = score;
            clearInterval(keeperInterval);
        }

        function resetGame() {
            startGame();
        }

        // ==========================================
        // Firebase ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ (ìˆœìœ„ ì €ì¥/ë¡œë“œ)
        // ==========================================

        function saveScore() {
            const name = document.getElementById('player-name').value;
            if (!name) {
                alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            // ë°ì´í„° ì €ì¥
            db.ref('rankings').push({
                name: name,
                score: score,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                alert("ë­í‚¹ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
                startGame(); // ê²Œì„ ì¬ì‹œì‘
            }).catch((error) => {
                console.error(error);
                alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            });
        }

        // ì‹¤ì‹œê°„ ë­í‚¹ ë¶ˆëŸ¬ì˜¤ê¸°
        const rankingList = document.getElementById('ranking-list');
        
        // ì ìˆ˜(score) ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ê°€ì ¸ì˜¤ê¸°
        db.ref('rankings').orderByChild('score').limitToLast(10).on('value', (snapshot) => {
            rankingList.innerHTML = "";
            let data = [];
            
            snapshot.forEach((childSnapshot) => {
                data.push(childSnapshot.val());
            });

            // FirebaseëŠ” ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬ì´ë¯€ë¡œ, ë‚´ë¦¼ì°¨ìˆœ(ë†’ì€ ì ìˆ˜ ë¨¼ì €)ìœ¼ë¡œ ë’¤ì§‘ê¸°
            data.reverse(); 

            if(data.length === 0) {
                rankingList.innerHTML = "<tr><td colspan='3'>ì•„ì§ ë“±ë¡ëœ ë­í‚¹ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>";
            } else {
                data.forEach((item, index) => {
                    const row = `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${item.name}</td>
                            <td>${item.score} ê³¨</td>
                        </tr>
                    `;
                    rankingList.innerHTML += row;
                });
            }
        });

        // ì´ˆê¸° ì‹¤í–‰
        startGame();

    </script>
</body>
</html>
